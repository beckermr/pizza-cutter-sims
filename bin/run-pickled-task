#!/usr/bin/env python
import sys
import cloudpickle
import subprocess


def main():
    input_file = sys.argv[1]
    output_file = sys.argv[2]

    with open(input_file, "rb") as fp:
        rd = cloudpickle.loads(fp)

    try:
        res = rd[0](*rd[1], **rd[2])

    except Exception as e:
        res = e

    with open(output_file, "wb") as fp:
        cloudpickle.dump(res, fp)

    subprocess.run("touch " + output_file + ".done", shell=True, check=True)


if __name__ == '__main__':
    main()
